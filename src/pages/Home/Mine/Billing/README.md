# 我的账单页面 - 充值功能说明

## 功能概述

我的账单页面提供了完整的财务管理功能，包括余额查看、收入统计、提现记录和**充值功能**。

## 充值功能详解

### 🎯 充值流程

充值功能采用**两步式设计**，提供更好的用户体验：

#### 第一步：选择充值金额
1. **余额显示**：显示当前账户余额
2. **金额选择**：提供预设金额标签（¥100、¥200、¥1000）
3. **自定义金额**：支持用户输入任意金额
4. **充值须知**：显示重要的充值规则和注意事项
5. **确认充值**：点击蓝色确认充值按钮进入下一步

#### 第二步：选择支付方式
1. **充值金额确认**：显示用户选择的充值金额
2. **支付方式选择**：支持支付宝和微信支付
3. **确认付款**：点击绿色确认付款按钮完成充值

### 💰 充值金额选项

- **预设金额**：
  - ¥100 - 适合小额充值
  - ¥200 - 中等金额充值
  - ¥1000 - 大额充值

- **自定义金额**：
  - 支持输入任意正整数金额
  - 实时更新充值金额状态

### 📋 充值须知

充值须知包含以下重要信息：

1. **提现手续费**：提现会产生1%的手续费
2. **违规处理**：账号违规自己转移套现将被冻结处理
3. **年龄限制**：禁止未成年人充值消费

### 💳 支付方式

- **支付宝**：蓝色图标，默认选中
  - 调用真实支付宝支付接口
  - 自动跳转到支付宝支付页面
  - 支持沙箱环境测试
- **微信支付**：绿色图标，支持选择
  - 暂时模拟支付流程
  - 后续可集成真实微信支付接口
- **动态按钮**：确认付款按钮根据支付方式动态变色
  - 支付宝：蓝色渐变按钮
  - 微信：绿色渐变按钮

### 🎨 界面特色

- **渐变背景**：弹窗标题使用白色背景，更加简洁
- **响应式设计**：支持不同屏幕尺寸
- **动画效果**：悬停时有轻微上浮和阴影变化
- **颜色区分**：不同步骤使用不同的主题色彩
- **动态按钮**：确认付款按钮根据支付方式智能变色

## 使用方法

### 基本充值流程

1. 在账单页面点击**"充值"**按钮
2. 选择充值金额（点击标签或输入自定义金额）
3. 阅读充值须知
4. 点击**"确认充值"**按钮
5. 选择支付方式（支付宝或微信）
6. 点击**"确认付款"**完成充值

### 快速充值

- 点击预设金额标签（¥100、¥200、¥1000）快速选择
- 支持键盘输入自定义金额

## 技术实现

### 状态管理

```tsx
const [rechargeModalVisible, setRechargeModalVisible] = useState(false);
const [rechargeAmount, setRechargeAmount] = useState(100);
const [rechargeStep, setRechargeStep] = useState<'amount' | 'payment'>('amount');
```

### 核心函数

- `handleRechargeAmountSelect()` - 处理充值金额选择
- `handleRechargeConfirm()` - 处理充值确认
- `handleRechargePayment()` - 处理充值支付
  - 支付宝：调用真实接口并自动跳转
  - 微信：模拟支付流程
- `handleRechargeCancel()` - 重置充值弹窗

### 订单号生成

```tsx
// 生成订单号（时间戳 + 随机数）
const outTradeNo = `R${Date.now()}${Math.floor(Math.random() * 1000)}`;
```

- 格式：`R` + 时间戳 + 3位随机数
- 示例：`R1703123456789123`
- 确保每次充值都有唯一的订单号

### 支付宝支付流程

1. 用户点击"确认付款"
2. 前端验证用户登录状态（检查token）
3. 生成唯一订单号（时间戳 + 随机数）
4. 调用后端接口 `POST /api/aliapy/payorder`
5. 请求头携带token认证：`Authorization: Bearer {token}`
6. 传递订单参数：
   ```json
   {
     "outTradeNo": "R1234567890123",
     "subject": "用户充值300元",
     "totalAmount": "300",
     "body": "账户充值"
   }
   ```
7. 后端直接返回完整的支付宝表单HTML
8. 前端在新窗口中打开支付页面，写入支付宝表单
9. 用户在新窗口中完成支付，支付完成后返回商户页面

### 样式系统

- 使用SCSS编写，支持嵌套和变量
- 响应式设计，适配移动端和桌面端
- 渐变背景和动画效果

## 注意事项

1. **金额验证**：充值金额必须为正整数
2. **用户认证**：充值前必须验证用户登录状态和token有效性
3. **支付安全**：实际项目中需要集成真实的支付API
4. **余额更新**：充值成功后会自动刷新余额数据
5. **错误处理**：包含完整的错误提示和异常处理
6. **Token管理**：确保token在localStorage中正确存储和更新

## 未来扩展

- 支持更多支付方式（银行卡、PayPal等）
- 添加充值优惠活动
- 支持充值记录查询
- 集成真实的支付网关
